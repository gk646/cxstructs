name: Build include dir on commit

on: [ push ]

jobs:
  copy_files:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout code
        uses: actions/checkout@v2

      - name: Copy Files
        run: |
          mkdir -p include/cxstructs
          mkdir -p include/cxalgo
        
          for file in $(find src/datastructures -name '*.h' -or -name '*.cpp'); do
            if sed -n '20p' $file | grep -q "#define FINISHED"; then
              filename=$(basename $file)
              cp $file ./include/cxstructs/$filename
            fi
          done
      
          for file in $(find src/algorithms -name '*.h' -or -name '*.cpp'); do
            if sed -n '20p' $file | grep -q "#define FINISHED"; then
              filename=$(basename $file)
              cp $file ./include/cxalgo/$filename
            fi
          done
          
          for file in $(find src/machinelearning -name '*.h' -or -name '*.cpp'); do
            if sed -n '20p' $file | grep -q "#define FINISHED"; then
              filename=$(basename $file)
              cp $file ./include/machinelearning/$filename
            fi
          done

      - name: Commit and push on change
        run: |
          git diff
          git add include/*
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git commit -am "Auto commit copied files" || exit 0
          git push